jQuery((function(t){window.dmChart={chartData:function(t,e,n){e.hasOwnProperty("error")?window.ADS.notify(e.error,"danger"):(d3.select(t).selectAll("svg").remove(),this.chartRender(t,n,e,e.from,e.to))},chartRender:function(e,n,i,a,r){var l=d3.select(e),s=5,o=30,c=30,d=50,u=l.node().getBoundingClientRect().width-d-o;n=n-s-c;var f=a!==r?d3.time.format("%d %B %Y"):d3.time.format("%H:00"),m=d3.tip().attr("class","d3-tip").html((function(t){return'<ul class="list-unstyled"><li>'+i.sub_title+': &nbsp;<span class="text-semibold pull-right">'+t.value+"</span></li><li>"+i.time+': &nbsp;<span class="text-semibold pull-right">'+f(t.date)+"</span></li></ul>"})),p=a!==r?d3.time.format("%Y/%m/%d").parse:d3.time.format("%Y-%m-%d %H:%M:%S").parse,h=d3.scale.ordinal().range(["#4CAF50","#FF5722","#5C6BC0"]),v=l.append("svg"),y=v.attr("width",u+d+o).attr("height",n+s+c).append("g").attr("transform","translate("+d+","+s+")").call(m);function g(){var e=d3.nest().key((function(t){return t.type})).map(i.data).value;h.domain(d3.keys(e[0]).filter((function(t){return"date"!==t&&"type"!==t})));var s=h.domain().map((function(t){return{name:t,values:e.map((function(e){return{name:t,date:p(e.date),value:parseFloat(e[t])}}))}})),c=d3.svg.line().x((function(t){return f(t.date)})).y((function(t){return g(t.value)})).interpolate("cardinal"),f=d3.time.scale().domain([d3.min(s,(function(t){return d3.min(t.values,(function(t){return t.date}))})),d3.max(s,(function(t){return d3.max(t.values,(function(t){return t.date}))}))]).range([0,u]),g=d3.scale.linear().domain([d3.min(s,(function(t){return d3.min(t.values,(function(t){return t.value}))})),d3.max(s,(function(t){return d3.max(t.values,(function(t){return t.value}))}))]).range([n,0]),x=a!==r?d3.time.days:d3.time.hours,w=a!==r?d3.time.format("%d %b"):d3.time.format("%H:00"),k=d3.svg.axis().scale(f).orient("bottom").tickPadding(8).ticks(x,4).innerTickSize(4).tickFormat(w),A=d3.svg.axis().scale(g).orient("left").tickPadding(8).ticks(6).tickSize(0-u);y.append("g").attr("class","d3-axis d3-axis-horizontal d3-axis-solid").attr("transform","translate(0,"+n+")"),y.append("g").attr("class","d3-axis d3-axis-vertical d3-axis-transparent");var b=y.selectAll(".lines").data(s);b.enter().append("g").attr("class","lines").attr("id",(function(t){return t.name+"-line"})).append("path").attr("class","d3-line d3-line-medium").style("stroke",(function(t){return h(t.name)})).style("opacity",0).attr("d",(function(t){return c(t.values[0])})).transition().duration(500).delay((function(t,e){return 200*e})).style("opacity",1);var z=b.selectAll("circle").data((function(t){return t.values})).enter().append("circle").attr("class","d3-line-circle d3-line-circle-medium").attr("cx",(function(t){return f(t.date)})).attr("cy",(function(t){return g(t.value)})).attr("r",3).style("fill","#fff").style("stroke",(function(t){return h(t.name)}));z.style("opacity",0).transition().duration(500).delay(500).style("opacity",1),z.on("mouseover",(function(t){m.offset([-15,0]).show(t),d3.select(this).transition().duration(250).attr("r",4)})).on("mouseout",(function(t){m.hide(t),d3.select(this).transition().duration(250).attr("r",3)})),b.each((function(){d3.select(d3.select(this).selectAll("circle")[0][0]).on("mouseover",(function(t){m.offset([0,15]).direction("e").show(t),d3.select(this).transition().duration(250).attr("r",4)})).on("mouseout",(function(t){m.direction("n").hide(t),d3.select(this).transition().duration(250).attr("r",3)}))})),b.each((function(){d3.select(d3.select(this).selectAll("circle")[0][d3.select(this).selectAll("circle").size()-1]).on("mouseover",(function(t){m.offset([0,-15]).direction("w").show(t),d3.select(this).transition().duration(250).attr("r",4)})).on("mouseout",(function(t){m.direction("n").hide(t),d3.select(this).transition().duration(250).attr("r",3)}))}));var C=d3.transition(b);function F(){u=l.node().getBoundingClientRect().width-d-o,v.attr("width",u+d+o),y.attr("width",u+d+o),f.range([0,u]),g.range([n,0]),y.select(".d3-axis-horizontal").call(k),y.select(".d3-axis-vertical").call(A.tickSize(0-u)),y.selectAll(".d3-line").attr("d",(function(t){return c(t.values)})),y.selectAll(".d3-line-circle").attr("cx",(function(t){return f(t.date)}))}C.select("path").attr("d",(function(t){return c(t.values)})),C.selectAll("circle").attr("cy",(function(t){return g(t.value)})).attr("cx",(function(t){return f(t.date)})),d3.transition(y).select(".d3-axis-vertical").call(A),d3.transition(y).select(".d3-axis-horizontal").attr("transform","translate(0,"+n+")").call(k),t(window).on("resize",F),t(document).on("click",".sidebar-control",F)}g(),d3.select(window).on("keydown",(function(){d3.event.altKey})).on("keyup",(function(){!1}))}}}));
